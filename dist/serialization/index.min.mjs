var d=Symbol.for("bitecs-u8"),R=Symbol.for("bitecs-i8"),D=Symbol.for("bitecs-u16"),U=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),$=Symbol.for("bitecs-i32"),h=Symbol.for("bitecs-f32"),E=Symbol.for("bitecs-f64"),z=Symbol.for("bitecs-ref"),j=Symbol.for("bitecs-str"),P=Symbol.for("bitecs-arr"),I=e=>(t=[])=>Object.defineProperty(t,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),Y=(e=[])=>I(d)(e),Z=(e=[])=>I(R)(e),_=(e=[])=>I(D)(e),ee=(e=[])=>I(U)(e),re=(e=[])=>I(A)(e),ne=(e=[])=>I($)(e),te=(e=[])=>I(h)(e),G=(e=[])=>I(E)(e),ie=(e=[])=>I(z)(e),ae=(e=[])=>I(j)(e),be=new Map([[Y,d],[Z,R],[_,D],[ee,U],[re,A],[ne,$],[te,h],[G,E],[ie,z],[ae,j]]),S={[d]:(e,t,n)=>(e.setUint8(t,n),1),[R]:(e,t,n)=>(e.setInt8(t,n),1),[D]:(e,t,n)=>(e.setUint16(t,n),2),[U]:(e,t,n)=>(e.setInt16(t,n),2),[A]:(e,t,n)=>(e.setUint32(t,n),4),[$]:(e,t,n)=>(e.setInt32(t,n),4),[h]:(e,t,n)=>(e.setFloat32(t,n),4),[E]:(e,t,n)=>(e.setFloat64(t,n),8),[z]:(e,t,n)=>(e.setUint32(t,n),4),[j]:(e,t,n)=>{let o=fe.encode(n),u=0;return u+=S[A](e,t+u,o.length),new Uint8Array(e.buffer,e.byteOffset+t+u,o.length).set(o),u+=o.length,u}},T={[d]:(e,t)=>({value:e.getUint8(t),size:1}),[R]:(e,t)=>({value:e.getInt8(t),size:1}),[D]:(e,t)=>({value:e.getUint16(t),size:2}),[U]:(e,t)=>({value:e.getInt16(t),size:2}),[A]:(e,t)=>({value:e.getUint32(t),size:4}),[$]:(e,t)=>({value:e.getInt32(t),size:4}),[h]:(e,t)=>({value:e.getFloat32(t),size:4}),[E]:(e,t)=>({value:e.getFloat64(t),size:8}),[z]:(e,t)=>({value:e.getUint32(t),size:4}),[j]:(e,t)=>{let{value:n,size:i}=T[A](e,t),o=new Uint8Array(e.buffer,e.byteOffset+t+i,n);return{value:Ae.decode(o),size:i+n}}};function N(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let t=be.get(e);if(t)return t;throw new Error(`Unknown type function: ${e}`)}return C(e)?N(e[P]):h}var fe=new TextEncoder,Ae=new TextDecoder;function ge(e=G){let t=[];return Object.defineProperty(t,P,{value:e,enumerable:!1,writable:!1,configurable:!1}),t}function M(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function O(e){if(C(e))return N(e[P]);for(let t of[d,R,D,U,A,$,h,E,j,z])if(t in e)return t;return e instanceof Int8Array?R:e instanceof Uint8Array?d:e instanceof Int16Array?U:e instanceof Uint16Array?D:e instanceof Int32Array?$:e instanceof Uint32Array?A:e instanceof Float32Array?h:E}function C(e){return Array.isArray(e)&&P in e}function F(e){return e[P]}function k(e,t,n,i){let o=0,u=Array.isArray(t)?1:0;if(o+=S[d](n,i,u),!u)return o;o+=S[A](n,i+o,t.length);for(let y=0;y<t.length;y++){let r=t[y];if(C(e))o+=k(F(e),r,n,i+o);else{let a=N(e);o+=S[a](n,i+o,r)}}return o}function w(e,t,n,i){let o=0,u=T[d](t,n+o);if(o+=u.size,!u.value)return{size:o};let y=T[A](t,n+o);o+=y.size;let r=new Array(y.value);for(let a=0;a<r.length;a++)if(C(e)){let{value:s,size:c}=w(F(e),t,n+o,i);o+=c,Array.isArray(s)&&(r[a]=s)}else{let s=N(e),{value:c,size:l}=T[s](t,n+o);if(o+=l,s===z){let m=i?i.get(c)??c:c;r[a]=m}else r[a]=c}return{value:r,size:o}}var Se=e=>{let t=O(e);return t===h||t===E},ze=(e,t)=>Se(e)?t:0,Te=(e,t)=>{let n=e.get(t);return n||(ArrayBuffer.isView(t)?n=new t.constructor(t.length):n=new Array(t.length).fill(0),e.set(t,n)),n},X=(e,t,n,i=1e-4)=>{let o=Te(e,t),u=t[n],y=ze(t,i),r=y>0?Math.abs(o[n]-u)>y:o[n]!==u;return o[n]=u,r},de=(e,t=!1,n,i=1e-4)=>{if(M(e)){let r=O(e),a=S[r];return(s,c,l,m)=>{if(t&&n){if(!X(n,e,l,i))return 0;let p=0;return p+=S[A](s,c+p,l),p+=S[A](s,c+p,m),p+=a(s,c+p,e[l]),p}else{let p=0;return p+=S[A](s,c+p,l),p+=a(s,c+p,e[l]),p}}}let o=Object.keys(e),y=o.map(r=>{let a=e[r];if(!M(a))throw new Error(`Invalid array type for property ${r}`);return O(a)}).map(r=>S[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,a,s,c)=>{if(t&&n){let l=0;for(let b=0;b<o.length;b++){let f=e[o[b]];X(n,f,s,i)&&(l|=1<<b)}if(l===0)return 0;let m=0;m+=S[A](r,a+m,s),m+=S[A](r,a+m,c);let p=o.length<=8?S[d]:o.length<=16?S[D]:S[A];m+=p(r,a+m,l);for(let b=0;b<o.length;b++)if(l&1<<b){let f=e[o[b]];C(f)?m+=k(F(f),f[s],r,a+m):m+=y[b](r,a+m,f[s])}return m}else{let l=0;l+=S[A](r,a+l,s);for(let m=0;m<o.length;m++){let p=e[o[m]];C(p)?l+=k(F(p),p[s],r,a+l):l+=y[m](r,a+l,p[s])}return l}}},De=(e,t=!1)=>{if(M(e)){let u=O(e),y=T[u];return(r,a,s)=>{let c=0,{value:l,size:m}=T[A](r,a);c+=m;let p=s?s.get(l)??l:l;if(t){let{size:g}=T[A](r,a+c);c+=g}let{value:b,size:f}=y(r,a+c);if(u===z){let g=s?s.get(b)??b:b;e[p]=g}else e[p]=b;return c+f}}let n=Object.keys(e),i=n.map(u=>{let y=e[u];if(!M(y))throw new Error(`Invalid array type for property ${u}`);return O(y)}),o=i.map(u=>T[u]||(()=>{throw new Error("Unsupported or unannotated type")}));return(u,y,r)=>{let a=0,{value:s,size:c}=T[A](u,y+a);a+=c;let l=r?r.get(s)??s:s;if(t){let{size:m}=T[A](u,y+a);a+=m;let p=n.length<=8?T[d]:n.length<=16?T[D]:T[A],{value:b,size:f}=p(u,y+a);a+=f;for(let g=0;g<n.length;g++)if(b&1<<g){let v=e[n[g]];if(C(v)){let{value:x,size:B}=w(F(v),u,y+a,r);Array.isArray(x)&&(v[l]=x),a+=B}else{let{value:x,size:B}=o[g](u,y+a);if(i[g]===z){let W=r?r.get(x)??x:x;e[n[g]][l]=W}else e[n[g]][l]=x;a+=B}}}else for(let m=0;m<n.length;m++){let p=e[n[m]];if(C(p)){let{value:b,size:f}=w(F(p),u,y+a,r);Array.isArray(b)&&(p[l]=b),a+=f}else{let{value:b,size:f}=o[m](u,y+a);if(i[m]===z){let g=r?r.get(b)??b:b;e[n[m]][l]=g}else e[n[m]][l]=b;a+=f}}return a}},L=(e,t={})=>{let{diff:n=!1,buffer:i=new ArrayBuffer(1024*1024*100),epsilon:o=1e-4}=t,u=new DataView(i),y=n?new Map:void 0,r=e.map(a=>de(a,n,y,o));return a=>{let s=0;for(let c=0;c<a.length;c++){let l=a[c];for(let m=0;m<r.length;m++)s+=r[m](u,s,l,m)}return i.slice(0,s)}},q=(e,t={})=>{let{diff:n=!1}=t,i=e.map(o=>De(o,n));return(o,u)=>{let y=new DataView(o),r=0;for(;r<o.byteLength;)if(n){let{value:a,size:s}=T[A](y,r),{value:c,size:l}=T[A](y,r+s);r+=i[c](y,r,u)}else for(let a=0;a<i.length;a++)r+=i[a](y,r,u)}};var he=e=>{let t=O(e);return t===h||t===E},oe=(e,t)=>he(e)?t:0,ye=(e,t)=>{let n=e.get(t);return n||(n=[],e.set(t,n)),n},H=(e,t,n,i)=>{let o=ye(e,t),u=t[n],y=o[n];if(u===void 0)return!1;if(y===void 0)return!0;if(typeof u=="object"&&u!==null){let r=t;for(let a in u)if(r[a]){let s=oe(r[a],i);if(s>0?Math.abs(y[a]-u[a])>s:y[a]!==u[a])return!0}return!1}else{let r=oe(t,i);return r>0?Math.abs(y-u)>r:y!==u}},se=(e,t,n)=>{let i=ye(e,t),o=t[n];typeof o=="object"&&o!==null?i[n]={...o}:i[n]=o},ve=(e,t,n,i=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(u=>isNaN(parseInt(u))&&typeof e[u]=="object")){let u=Object.keys(e).filter(a=>isNaN(parseInt(a))),r=u.map(a=>O(e[a])).map(a=>S[a]);return(a,s,c)=>{let l=e[c];if(l===void 0)return 0;if(t&&n){if(!H(n,e,c,i))return 0;se(n,e,c)}let m=0;for(let p=0;p<u.length;p++){let b=e[u[p]],f=l[u[p]];C(b)?m+=k(F(b),f,a,s+m):m+=r[p](a,s+m,f)}return m}}else{let u=O(e),y=S[u];return(r,a,s)=>{let c=e[s];if(c===void 0)return 0;if(t&&n){if(!H(n,e,s,i))return 0;se(n,e,s)}return y(r,a,c)}}},Re=e=>{if(typeof e=="object"&&Object.keys(e).some(n=>isNaN(parseInt(n))&&typeof e[n]=="object")){let n=Object.keys(e).filter(u=>isNaN(parseInt(u))),i=n.map(u=>O(e[u])),o=i.map(u=>T[u]);return(u,y,r,a)=>{let s=0,c={};for(let l=0;l<n.length;l++){let m=e[n[l]];if(C(m)){let{value:p,size:b}=w(F(m),u,y+s,a);Array.isArray(p)&&(c[n[l]]=p),s+=b}else{let{value:p,size:b}=o[l](u,y+s);if(i[l]===z){let f=a?a.get(p)??p:p;c[n[l]]=f}else c[n[l]]=p;s+=b}}return e[r]=c,s}}else{let n=O(e),i=T[n];return(o,u,y,r)=>{let{value:a,size:s}=i(o,u);if(n===z){let c=r?r.get(a)??a:a;e[y]=c}else e[y]=a;return s}}},Ue=(e,t={})=>{let{diff:n=!1,buffer:i=new ArrayBuffer(1024*1024*100),epsilon:o=1e-4}=t,u=new DataView(i),y=n?new Map:void 0,r=e.map(a=>ve(a,n,y,o));return a=>{let s=0;for(let c=0;c<a.length;c++){let l=a[c];if(n){let m=!1;for(let g=0;g<e.length;g++)if(y&&H(y,e[g],l,o)){m=!0;break}if(!m)continue;s+=S[A](u,s,l);let p=s,b=e.length<=8?S[d]:e.length<=16?S[D]:S[A];s+=b===S[d]?1:b===S[D]?2:4;let f=0;for(let g=0;g<r.length;g++){let v=r[g](u,s,l);v>0&&(f|=1<<g,s+=v)}b(u,p,f)}else{s+=S[A](u,s,l);for(let m=0;m<r.length;m++)s+=r[m](u,s,l)}}return i.slice(0,s)}},$e=(e,t={})=>{let{diff:n=!1}=t,i=e.map(o=>Re(o));return(o,u)=>{let y=new DataView(o),r=0;for(;r<o.byteLength;){let{value:a,size:s}=T[A](y,r);r+=s;let c=u?u.get(a)??a:a;if(n){let l=e.length<=8?T[d]:e.length<=16?T[D]:T[A],{value:m,size:p}=l(y,r);r+=p;for(let b=0;b<e.length;b++)m&1<<b&&(r+=i[b](y,r,c,u))}else for(let l=0;l<i.length;l++)r+=i[l](y,r,c,u)}}};import{addComponent as ue,hasComponent as Oe,getAllEntities as Ce,addEntity as le,isRelation as ce,getRelationTargets as xe,Wildcard as ar}from"bitecs";function Ee(e,t,n,i){if(!e)return i;if(Array.isArray(e)){let o=e[t];return o!==void 0?z in e?(n.setUint32(i,o),i+4):(n.setFloat64(i,o),i+8):i}if(typeof e=="object"){let o=Object.keys(e).sort();for(let u of o){let y=e[u],r=y[t];r!==void 0&&(y instanceof Int8Array||R in y?(n.setInt8(i,r),i+=1):y instanceof Uint8Array||d in y?(n.setUint8(i,r),i+=1):y instanceof Int16Array||U in y?(n.setInt16(i,r),i+=2):y instanceof Uint16Array||D in y?(n.setUint16(i,r),i+=2):y instanceof Int32Array||$ in y?(n.setInt32(i,r),i+=4):y instanceof Uint32Array||A in y||z in y?(n.setUint32(i,r),i+=4):y instanceof Float32Array||h in y?(n.setFloat32(i,r),i+=4):(n.setFloat64(i,r),i+=8))}}return i}function Ie(e,t,n,i,o){if(!e)return i;if(Array.isArray(e)){if(z in e){let u=n.getUint32(i),y=o?o.get(u)??u:u;return e[t]=y,i+4}return e[t]=n.getFloat64(i),i+8}if(typeof e=="object"){let u=Object.keys(e).sort();for(let y of u){let r=e[y];if(r instanceof Int8Array||R in r)r[t]=n.getInt8(i),i+=1;else if(r instanceof Uint8Array||d in r)r[t]=n.getUint8(i),i+=1;else if(r instanceof Int16Array||U in r)r[t]=n.getInt16(i),i+=2;else if(r instanceof Uint16Array||D in r)r[t]=n.getUint16(i),i+=2;else if(r instanceof Int32Array||$ in r)r[t]=n.getInt32(i),i+=4;else if(r instanceof Uint32Array||A in r||z in r){let a=n.getUint32(i);if(z in r){let s=o?o.get(a)??a:a;r[t]=s}else r[t]=a;i+=4}else r instanceof Float32Array||h in r?(r[t]=n.getFloat32(i),i+=4):(r[t]=n.getFloat64(i),i+=8)}}return i}var Fe=(e,t,n=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(n),o=0,u=r=>{let a=r.length;i.setUint32(o,a),o+=4;for(let s=0;s<a;s++){let c=r[s],l=0;i.setUint32(o,c),o+=4;let m=o;o+=1;for(let p=0;p<t.length;p++){let b=t[p];if(ce(b)){let f=xe(e,c,b);for(let g of f){i.setUint8(o,p),o+=1,i.setUint32(o,g),o+=4;let v=b(g);o=Ee(v,c,i,o),l++}}else Oe(e,c,b)&&(i.setUint8(o,p),o+=1,l++)}i.setUint8(m,l)}},y=r=>{let s=L(t,{buffer:n.slice(o)})(r);new Uint8Array(n).set(new Uint8Array(s),o),o+=s.byteLength};return r=>{o=0;let a=r??Ce(e);return u(a),y(a),n.slice(0,o)}},Be=(e,t,n)=>{let i=n||new Map,o=q(t);return(u,y)=>{let r=y||i,a=new DataView(u),s=0,c=a.getUint32(s);s+=4;for(let l=0;l<c;l++){let m=a.getUint32(s);s+=4;let p=r.get(m);p===void 0&&(p=le(e),r.set(m,p));let b=a.getUint8(s);s+=1;for(let f=0;f<b;f++){let g=a.getUint8(s);s+=1;let v=t[g];if(ce(v)){let x=a.getUint32(s);s+=4;let B=r.get(x);B===void 0&&(B=le(e),r.set(x,B));let W=v(B);ue(e,p,W),s=Ie(W,p,a,s,r)}else ue(e,p,v)}}return o(u.slice(s),r),r}};import{addComponent as J,removeComponent as pe,addEntity as je,removeEntity as Ve,observe as V,onAdd as K,onRemove as Q,entityExists as ke,isRelation as we,getRelationTargets as Pe,Wildcard as me}from"bitecs";function We(e,t,n,i){if(!e)return i;if(Array.isArray(e)){let o=e[t];return o!==void 0?z in e?(n.setUint32(i,o),i+4):(n.setFloat64(i,o),i+8):i}if(typeof e=="object"){let o=Object.keys(e).sort();for(let u of o){let y=e[u],r=y[t];r!==void 0&&(y instanceof Int8Array||R in y?(n.setInt8(i,r),i+=1):y instanceof Uint8Array||d in y?(n.setUint8(i,r),i+=1):y instanceof Int16Array||U in y?(n.setInt16(i,r),i+=2):y instanceof Uint16Array||D in y?(n.setUint16(i,r),i+=2):y instanceof Int32Array||$ in y?(n.setInt32(i,r),i+=4):y instanceof Uint32Array||A in y||z in y?(n.setUint32(i,r),i+=4):y instanceof Float32Array||h in y?(n.setFloat32(i,r),i+=4):(n.setFloat64(i,r),i+=8))}}return i}function Me(e,t,n,i,o){if(!e)return i;if(Array.isArray(e)){if(z in e){let u=n.getUint32(i),y=o?o.get(u)??u:u;return e[t]=y,i+4}return e[t]=n.getFloat64(i),i+8}if(typeof e=="object"){let u=Object.keys(e).sort();for(let y of u){let r=e[y];if(r instanceof Int8Array||R in r)r[t]=n.getInt8(i),i+=1;else if(r instanceof Uint8Array||d in r)r[t]=n.getUint8(i),i+=1;else if(r instanceof Int16Array||U in r)r[t]=n.getInt16(i),i+=2;else if(r instanceof Uint16Array||D in r)r[t]=n.getUint16(i),i+=2;else if(r instanceof Int32Array||$ in r)r[t]=n.getInt32(i),i+=4;else if(r instanceof Uint32Array||A in r||z in r){let a=n.getUint32(i);if(z in r){let s=o?o.get(a)??a:a;r[t]=s}else r[t]=a;i+=4}else r instanceof Float32Array||h in r?(r[t]=n.getFloat32(i),i+=4):(r[t]=n.getFloat64(i),i+=8)}}return i}var Ne=(e,t,n,i={})=>{let o=i.buffer??new ArrayBuffer(104857600),u=new DataView(o),y=0,r=[],a=new Map;return V(e,K(t),s=>{r.push([s,0,-1])}),V(e,Q(t),s=>{r.push([s,1,-1]),a.delete(s)}),n.forEach((s,c)=>{we(s)?(V(e,K(t,s(me)),l=>{let m=Pe(e,l,s);for(let p of m){a.has(l)||a.set(l,new Map),a.get(l).set(c,p);let b=s(p);r.push([l,4,c,p,b])}}),V(e,Q(t,s(me)),l=>{let m=a.get(l);if(m){let p=m.get(c);p!==void 0&&(r.push([l,5,c,p]),m.delete(c),m.size===0&&a.delete(l))}})):(V(e,K(t,s),l=>{r.push([l,2,c])}),V(e,Q(t,s),l=>{r.push([l,3,c])}))}),()=>{y=0;for(let s=0;s<r.length;s++){let[c,l,m,p,b]=r[s];u.setUint32(y,c),y+=4,u.setUint8(y,l),y+=1,(l===2||l===3||l===4||l===5)&&(u.setUint8(y,m),y+=1,(l===4||l===5)&&(u.setUint32(y,p),y+=4,l===4&&b&&(y=We(b,c,u,y))))}return r.length=0,o.slice(0,y)}},Ge=(e,t,n,i={})=>{let o=i.idMap||new Map;return(u,y)=>{let r=y||o,a=new DataView(u),s=0;for(;s<u.byteLength;){let c=a.getUint32(s);s+=4;let l=a.getUint8(s);s+=1;let m=-1,p=-1;(l===2||l===3||l===4||l===5)&&(m=a.getUint8(s),s+=1,(l===4||l===5)&&(p=a.getUint32(s),s+=4));let b=n[m],f=r.get(c);if(l===0)f===void 0?(f=je(e),r.set(c,f),J(e,f,t)):console.warn(`Attempted to deserialize addEntity with ID ${c}, but it has already been deserialzied and exists in the mapping.`);else if(f!==void 0&&ke(e,f)){if(l===1)Ve(e,f),r.delete(c);else if(l===2)J(e,f,b);else if(l===3)pe(e,f,b);else if(l===4){let g=r.get(p);if(g!==void 0){let v=b(g);J(e,f,v),s=Me(v,f,a,s,r)}}else if(l===5){let g=r.get(p);g!==void 0&&pe(e,f,b(g))}}}return r}};export{h as $f32,E as $f64,U as $i16,$ as $i32,R as $i8,z as $ref,j as $str,D as $u16,A as $u32,d as $u8,ge as array,$e as createAoSDeserializer,Ue as createAoSSerializer,Ge as createObserverDeserializer,Ne as createObserverSerializer,Be as createSnapshotDeserializer,Fe as createSnapshotSerializer,q as createSoADeserializer,L as createSoASerializer,te as f32,G as f64,ee as i16,ne as i32,Z as i8,ie as ref,ae as str,_ as u16,re as u32,Y as u8};
//# sourceMappingURL=index.min.mjs.map
