var J=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var ge=Object.prototype.hasOwnProperty;var Se=(e,n)=>{for(var t in n)J(e,t,{get:n[t],enumerable:!0})},ze=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of Ae(n))!ge.call(e,a)&&a!==t&&J(e,a,{get:()=>n[a],enumerable:!(i=fe(n,a))||i.enumerable});return e};var Te=e=>ze(J({},"__esModule",{value:!0}),e);var Ve={};Se(Ve,{$f32:()=>v,$f64:()=>x,$i16:()=>O,$i32:()=>C,$i8:()=>$,$ref:()=>z,$str:()=>k,$u16:()=>h,$u32:()=>A,$u8:()=>D,array:()=>ae,createAoSDeserializer:()=>le,createAoSSerializer:()=>ue,createObserverDeserializer:()=>be,createObserverSerializer:()=>me,createSnapshotDeserializer:()=>pe,createSnapshotSerializer:()=>ce,createSoADeserializer:()=>H,createSoASerializer:()=>q,f32:()=>ee,f64:()=>G,i16:()=>Y,i32:()=>_,i8:()=>Q,ref:()=>re,str:()=>ne,u16:()=>X,u32:()=>Z,u8:()=>K});module.exports=Te(Ve);var D=Symbol.for("bitecs-u8"),$=Symbol.for("bitecs-i8"),h=Symbol.for("bitecs-u16"),O=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),C=Symbol.for("bitecs-i32"),v=Symbol.for("bitecs-f32"),x=Symbol.for("bitecs-f64"),z=Symbol.for("bitecs-ref"),k=Symbol.for("bitecs-str"),W=Symbol.for("bitecs-arr"),B=e=>(n=[])=>Object.defineProperty(n,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),K=(e=[])=>B(D)(e),Q=(e=[])=>B($)(e),X=(e=[])=>B(h)(e),Y=(e=[])=>B(O)(e),Z=(e=[])=>B(A)(e),_=(e=[])=>B(C)(e),ee=(e=[])=>B(v)(e),G=(e=[])=>B(x)(e),re=(e=[])=>B(z)(e),ne=(e=[])=>B(k)(e),de=new Map([[K,D],[Q,$],[X,h],[Y,O],[Z,A],[_,C],[ee,v],[G,x],[re,z],[ne,k]]),T={[D]:(e,n,t)=>(e.setUint8(n,t),1),[$]:(e,n,t)=>(e.setInt8(n,t),1),[h]:(e,n,t)=>(e.setUint16(n,t),2),[O]:(e,n,t)=>(e.setInt16(n,t),2),[A]:(e,n,t)=>(e.setUint32(n,t),4),[C]:(e,n,t)=>(e.setInt32(n,t),4),[v]:(e,n,t)=>(e.setFloat32(n,t),4),[x]:(e,n,t)=>(e.setFloat64(n,t),8),[z]:(e,n,t)=>(e.setUint32(n,t),4),[k]:(e,n,t)=>{let a=De.encode(t),u=0;return u+=T[A](e,n+u,a.length),new Uint8Array(e.buffer,e.byteOffset+n+u,a.length).set(a),u+=a.length,u}},d={[D]:(e,n)=>({value:e.getUint8(n),size:1}),[$]:(e,n)=>({value:e.getInt8(n),size:1}),[h]:(e,n)=>({value:e.getUint16(n),size:2}),[O]:(e,n)=>({value:e.getInt16(n),size:2}),[A]:(e,n)=>({value:e.getUint32(n),size:4}),[C]:(e,n)=>({value:e.getInt32(n),size:4}),[v]:(e,n)=>({value:e.getFloat32(n),size:4}),[x]:(e,n)=>({value:e.getFloat64(n),size:8}),[z]:(e,n)=>({value:e.getUint32(n),size:4}),[k]:(e,n)=>{let{value:t,size:i}=d[A](e,n),a=new Uint8Array(e.buffer,e.byteOffset+n+i,t);return{value:he.decode(a),size:i+t}}};function L(e){if(typeof e=="symbol")return e;if(typeof e=="function"){let n=de.get(e);if(n)return n;throw new Error(`Unknown type function: ${e}`)}return I(e)?L(e[W]):v}var De=new TextEncoder,he=new TextDecoder;function ae(e=G){let n=[];return Object.defineProperty(n,W,{value:e,enumerable:!1,writable:!1,configurable:!1}),n}function N(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function E(e){if(I(e))return L(e[W]);for(let n of[D,$,h,O,A,C,v,x,k,z])if(n in e)return n;return e instanceof Int8Array?$:e instanceof Uint8Array?D:e instanceof Int16Array?O:e instanceof Uint16Array?h:e instanceof Int32Array?C:e instanceof Uint32Array?A:e instanceof Float32Array?v:x}function I(e){return Array.isArray(e)&&W in e}function j(e){return e[W]}function w(e,n,t,i){let a=0,u=Array.isArray(n)?1:0;if(a+=T[D](t,i,u),!u)return a;a+=T[A](t,i+a,n.length);for(let y=0;y<n.length;y++){let r=n[y];if(I(e))a+=w(j(e),r,t,i+a);else{let o=L(e);a+=T[o](t,i+a,r)}}return a}function P(e,n,t,i){let a=0,u=d[D](n,t+a);if(a+=u.size,!u.value)return{size:a};let y=d[A](n,t+a);a+=y.size;let r=new Array(y.value);for(let o=0;o<r.length;o++)if(I(e)){let{value:s,size:c}=P(j(e),n,t+a,i);a+=c,Array.isArray(s)&&(r[o]=s)}else{let s=L(e),{value:c,size:l}=d[s](n,t+a);if(a+=l,s===z){let m=i?i.get(c)??c:c;r[o]=m}else r[o]=c}return{value:r,size:a}}var ve=e=>{let n=E(e);return n===v||n===x},Re=(e,n)=>ve(e)?n:0,Ue=(e,n)=>{let t=e.get(n);return t||(ArrayBuffer.isView(n)?t=new n.constructor(n.length):t=new Array(n.length).fill(0),e.set(n,t)),t},ie=(e,n,t,i=1e-4)=>{let a=Ue(e,n),u=n[t],y=Re(n,i),r=y>0?Math.abs(a[t]-u)>y:a[t]!==u;return a[t]=u,r},$e=(e,n=!1,t,i=1e-4)=>{if(N(e)){let r=E(e),o=T[r];return(s,c,l,m)=>{if(n&&t){if(!ie(t,e,l,i))return 0;let p=0;return p+=T[A](s,c+p,l),p+=T[A](s,c+p,m),p+=o(s,c+p,e[l]),p}else{let p=0;return p+=T[A](s,c+p,l),p+=o(s,c+p,e[l]),p}}}let a=Object.keys(e),y=a.map(r=>{let o=e[r];if(!N(o))throw new Error(`Invalid array type for property ${r}`);return E(o)}).map(r=>T[r]||(()=>{throw new Error("Unsupported or unannotated type")}));return(r,o,s,c)=>{if(n&&t){let l=0;for(let b=0;b<a.length;b++){let f=e[a[b]];ie(t,f,s,i)&&(l|=1<<b)}if(l===0)return 0;let m=0;m+=T[A](r,o+m,s),m+=T[A](r,o+m,c);let p=a.length<=8?T[D]:a.length<=16?T[h]:T[A];m+=p(r,o+m,l);for(let b=0;b<a.length;b++)if(l&1<<b){let f=e[a[b]];I(f)?m+=w(j(f),f[s],r,o+m):m+=y[b](r,o+m,f[s])}return m}else{let l=0;l+=T[A](r,o+l,s);for(let m=0;m<a.length;m++){let p=e[a[m]];I(p)?l+=w(j(p),p[s],r,o+l):l+=y[m](r,o+l,p[s])}return l}}},Oe=(e,n=!1)=>{if(N(e)){let u=E(e),y=d[u];return(r,o,s)=>{let c=0,{value:l,size:m}=d[A](r,o);c+=m;let p=s?s.get(l)??l:l;if(n){let{size:S}=d[A](r,o+c);c+=S}let{value:b,size:f}=y(r,o+c);if(u===z){let S=s?s.get(b)??b:b;e[p]=S}else e[p]=b;return c+f}}let t=Object.keys(e),i=t.map(u=>{let y=e[u];if(!N(y))throw new Error(`Invalid array type for property ${u}`);return E(y)}),a=i.map(u=>d[u]||(()=>{throw new Error("Unsupported or unannotated type")}));return(u,y,r)=>{let o=0,{value:s,size:c}=d[A](u,y+o);o+=c;let l=r?r.get(s)??s:s;if(n){let{size:m}=d[A](u,y+o);o+=m;let p=t.length<=8?d[D]:t.length<=16?d[h]:d[A],{value:b,size:f}=p(u,y+o);o+=f;for(let S=0;S<t.length;S++)if(b&1<<S){let U=e[t[S]];if(I(U)){let{value:F,size:V}=P(j(U),u,y+o,r);Array.isArray(F)&&(U[l]=F),o+=V}else{let{value:F,size:V}=a[S](u,y+o);if(i[S]===z){let M=r?r.get(F)??F:F;e[t[S]][l]=M}else e[t[S]][l]=F;o+=V}}}else for(let m=0;m<t.length;m++){let p=e[t[m]];if(I(p)){let{value:b,size:f}=P(j(p),u,y+o,r);Array.isArray(b)&&(p[l]=b),o+=f}else{let{value:b,size:f}=a[m](u,y+o);if(i[m]===z){let S=r?r.get(b)??b:b;e[t[m]][l]=S}else e[t[m]][l]=b;o+=f}}return o}},q=(e,n={})=>{let{diff:t=!1,buffer:i=new ArrayBuffer(1024*1024*100),epsilon:a=1e-4}=n,u=new DataView(i),y=t?new Map:void 0,r=e.map(o=>$e(o,t,y,a));return o=>{let s=0;for(let c=0;c<o.length;c++){let l=o[c];for(let m=0;m<r.length;m++)s+=r[m](u,s,l,m)}return i.slice(0,s)}},H=(e,n={})=>{let{diff:t=!1}=n,i=e.map(a=>Oe(a,t));return(a,u)=>{let y=new DataView(a),r=0;for(;r<a.byteLength;)if(t){let{value:o,size:s}=d[A](y,r),{value:c,size:l}=d[A](y,r+s);r+=i[c](y,r,u)}else for(let o=0;o<i.length;o++)r+=i[o](y,r,u)}};var Ce=e=>{let n=E(e);return n===v||n===x},oe=(e,n)=>Ce(e)?n:0,ye=(e,n)=>{let t=e.get(n);return t||(t=[],e.set(n,t)),t},te=(e,n,t,i)=>{let a=ye(e,n),u=n[t],y=a[t];if(u===void 0)return!1;if(y===void 0)return!0;if(typeof u=="object"&&u!==null){let r=n;for(let o in u)if(r[o]){let s=oe(r[o],i);if(s>0?Math.abs(y[o]-u[o])>s:y[o]!==u[o])return!0}return!1}else{let r=oe(n,i);return r>0?Math.abs(y-u)>r:y!==u}},se=(e,n,t)=>{let i=ye(e,n),a=n[t];typeof a=="object"&&a!==null?i[t]={...a}:i[t]=a},xe=(e,n,t,i=1e-4)=>{if(typeof e=="object"&&Object.keys(e).some(u=>isNaN(parseInt(u))&&typeof e[u]=="object")){let u=Object.keys(e).filter(o=>isNaN(parseInt(o))),r=u.map(o=>E(e[o])).map(o=>T[o]);return(o,s,c)=>{let l=e[c];if(l===void 0)return 0;if(n&&t){if(!te(t,e,c,i))return 0;se(t,e,c)}let m=0;for(let p=0;p<u.length;p++){let b=e[u[p]],f=l[u[p]];I(b)?m+=w(j(b),f,o,s+m):m+=r[p](o,s+m,f)}return m}}else{let u=E(e),y=T[u];return(r,o,s)=>{let c=e[s];if(c===void 0)return 0;if(n&&t){if(!te(t,e,s,i))return 0;se(t,e,s)}return y(r,o,c)}}},Ee=e=>{if(typeof e=="object"&&Object.keys(e).some(t=>isNaN(parseInt(t))&&typeof e[t]=="object")){let t=Object.keys(e).filter(u=>isNaN(parseInt(u))),i=t.map(u=>E(e[u])),a=i.map(u=>d[u]);return(u,y,r,o)=>{let s=0,c={};for(let l=0;l<t.length;l++){let m=e[t[l]];if(I(m)){let{value:p,size:b}=P(j(m),u,y+s,o);Array.isArray(p)&&(c[t[l]]=p),s+=b}else{let{value:p,size:b}=a[l](u,y+s);if(i[l]===z){let f=o?o.get(p)??p:p;c[t[l]]=f}else c[t[l]]=p;s+=b}}return e[r]=c,s}}else{let t=E(e),i=d[t];return(a,u,y,r)=>{let{value:o,size:s}=i(a,u);if(t===z){let c=r?r.get(o)??o:o;e[y]=c}else e[y]=o;return s}}},ue=(e,n={})=>{let{diff:t=!1,buffer:i=new ArrayBuffer(1024*1024*100),epsilon:a=1e-4}=n,u=new DataView(i),y=t?new Map:void 0,r=e.map(o=>xe(o,t,y,a));return o=>{let s=0;for(let c=0;c<o.length;c++){let l=o[c];if(t){let m=!1;for(let S=0;S<e.length;S++)if(y&&te(y,e[S],l,a)){m=!0;break}if(!m)continue;s+=T[A](u,s,l);let p=s,b=e.length<=8?T[D]:e.length<=16?T[h]:T[A];s+=b===T[D]?1:b===T[h]?2:4;let f=0;for(let S=0;S<r.length;S++){let U=r[S](u,s,l);U>0&&(f|=1<<S,s+=U)}b(u,p,f)}else{s+=T[A](u,s,l);for(let m=0;m<r.length;m++)s+=r[m](u,s,l)}}return i.slice(0,s)}},le=(e,n={})=>{let{diff:t=!1}=n,i=e.map(a=>Ee(a));return(a,u)=>{let y=new DataView(a),r=0;for(;r<a.byteLength;){let{value:o,size:s}=d[A](y,r);r+=s;let c=u?u.get(o)??o:o;if(t){let l=e.length<=8?d[D]:e.length<=16?d[h]:d[A],{value:m,size:p}=l(y,r);r+=p;for(let b=0;b<e.length;b++)m&1<<b&&(r+=i[b](y,r,c,u))}else for(let l=0;l<i.length;l++)r+=i[l](y,r,c,u)}}};var R=require("bitecs");function Ie(e,n,t,i){if(!e)return i;if(Array.isArray(e)){let a=e[n];return a!==void 0?z in e?(t.setUint32(i,a),i+4):(t.setFloat64(i,a),i+8):i}if(typeof e=="object"){let a=Object.keys(e).sort();for(let u of a){let y=e[u],r=y[n];r!==void 0&&(y instanceof Int8Array||$ in y?(t.setInt8(i,r),i+=1):y instanceof Uint8Array||D in y?(t.setUint8(i,r),i+=1):y instanceof Int16Array||O in y?(t.setInt16(i,r),i+=2):y instanceof Uint16Array||h in y?(t.setUint16(i,r),i+=2):y instanceof Int32Array||C in y?(t.setInt32(i,r),i+=4):y instanceof Uint32Array||A in y||z in y?(t.setUint32(i,r),i+=4):y instanceof Float32Array||v in y?(t.setFloat32(i,r),i+=4):(t.setFloat64(i,r),i+=8))}}return i}function Fe(e,n,t,i,a){if(!e)return i;if(Array.isArray(e)){if(z in e){let u=t.getUint32(i),y=a?a.get(u)??u:u;return e[n]=y,i+4}return e[n]=t.getFloat64(i),i+8}if(typeof e=="object"){let u=Object.keys(e).sort();for(let y of u){let r=e[y];if(r instanceof Int8Array||$ in r)r[n]=t.getInt8(i),i+=1;else if(r instanceof Uint8Array||D in r)r[n]=t.getUint8(i),i+=1;else if(r instanceof Int16Array||O in r)r[n]=t.getInt16(i),i+=2;else if(r instanceof Uint16Array||h in r)r[n]=t.getUint16(i),i+=2;else if(r instanceof Int32Array||C in r)r[n]=t.getInt32(i),i+=4;else if(r instanceof Uint32Array||A in r||z in r){let o=t.getUint32(i);if(z in r){let s=a?a.get(o)??o:o;r[n]=s}else r[n]=o;i+=4}else r instanceof Float32Array||v in r?(r[n]=t.getFloat32(i),i+=4):(r[n]=t.getFloat64(i),i+=8)}}return i}var ce=(e,n,t=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(t),a=0,u=r=>{let o=r.length;i.setUint32(a,o),a+=4;for(let s=0;s<o;s++){let c=r[s],l=0;i.setUint32(a,c),a+=4;let m=a;a+=1;for(let p=0;p<n.length;p++){let b=n[p];if((0,R.isRelation)(b)){let f=(0,R.getRelationTargets)(e,c,b);for(let S of f){i.setUint8(a,p),a+=1,i.setUint32(a,S),a+=4;let U=b(S);a=Ie(U,c,i,a),l++}}else(0,R.hasComponent)(e,c,b)&&(i.setUint8(a,p),a+=1,l++)}i.setUint8(m,l)}},y=r=>{let s=q(n,{buffer:t.slice(a)})(r);new Uint8Array(t).set(new Uint8Array(s),a),a+=s.byteLength};return r=>{a=0;let o=r??(0,R.getAllEntities)(e);return u(o),y(o),t.slice(0,a)}},pe=(e,n,t)=>{let i=t||new Map,a=H(n);return(u,y)=>{let r=y||i,o=new DataView(u),s=0,c=o.getUint32(s);s+=4;for(let l=0;l<c;l++){let m=o.getUint32(s);s+=4;let p=r.get(m);p===void 0&&(p=(0,R.addEntity)(e),r.set(m,p));let b=o.getUint8(s);s+=1;for(let f=0;f<b;f++){let S=o.getUint8(s);s+=1;let U=n[S];if((0,R.isRelation)(U)){let F=o.getUint32(s);s+=4;let V=r.get(F);V===void 0&&(V=(0,R.addEntity)(e),r.set(F,V));let M=U(V);(0,R.addComponent)(e,p,M),s=Fe(M,p,o,s,r)}else(0,R.addComponent)(e,p,U)}}return a(u.slice(s),r),r}};var g=require("bitecs");function Be(e,n,t,i){if(!e)return i;if(Array.isArray(e)){let a=e[n];return a!==void 0?z in e?(t.setUint32(i,a),i+4):(t.setFloat64(i,a),i+8):i}if(typeof e=="object"){let a=Object.keys(e).sort();for(let u of a){let y=e[u],r=y[n];r!==void 0&&(y instanceof Int8Array||$ in y?(t.setInt8(i,r),i+=1):y instanceof Uint8Array||D in y?(t.setUint8(i,r),i+=1):y instanceof Int16Array||O in y?(t.setInt16(i,r),i+=2):y instanceof Uint16Array||h in y?(t.setUint16(i,r),i+=2):y instanceof Int32Array||C in y?(t.setInt32(i,r),i+=4):y instanceof Uint32Array||A in y||z in y?(t.setUint32(i,r),i+=4):y instanceof Float32Array||v in y?(t.setFloat32(i,r),i+=4):(t.setFloat64(i,r),i+=8))}}return i}function je(e,n,t,i,a){if(!e)return i;if(Array.isArray(e)){if(z in e){let u=t.getUint32(i),y=a?a.get(u)??u:u;return e[n]=y,i+4}return e[n]=t.getFloat64(i),i+8}if(typeof e=="object"){let u=Object.keys(e).sort();for(let y of u){let r=e[y];if(r instanceof Int8Array||$ in r)r[n]=t.getInt8(i),i+=1;else if(r instanceof Uint8Array||D in r)r[n]=t.getUint8(i),i+=1;else if(r instanceof Int16Array||O in r)r[n]=t.getInt16(i),i+=2;else if(r instanceof Uint16Array||h in r)r[n]=t.getUint16(i),i+=2;else if(r instanceof Int32Array||C in r)r[n]=t.getInt32(i),i+=4;else if(r instanceof Uint32Array||A in r||z in r){let o=t.getUint32(i);if(z in r){let s=a?a.get(o)??o:o;r[n]=s}else r[n]=o;i+=4}else r instanceof Float32Array||v in r?(r[n]=t.getFloat32(i),i+=4):(r[n]=t.getFloat64(i),i+=8)}}return i}var me=(e,n,t,i={})=>{let a=i.buffer??new ArrayBuffer(104857600),u=new DataView(a),y=0,r=[],o=new Map;return(0,g.observe)(e,(0,g.onAdd)(n),s=>{r.push([s,0,-1])}),(0,g.observe)(e,(0,g.onRemove)(n),s=>{r.push([s,1,-1]),o.delete(s)}),t.forEach((s,c)=>{(0,g.isRelation)(s)?((0,g.observe)(e,(0,g.onAdd)(n,s(g.Wildcard)),l=>{let m=(0,g.getRelationTargets)(e,l,s);for(let p of m){o.has(l)||o.set(l,new Map),o.get(l).set(c,p);let b=s(p);r.push([l,4,c,p,b])}}),(0,g.observe)(e,(0,g.onRemove)(n,s(g.Wildcard)),l=>{let m=o.get(l);if(m){let p=m.get(c);p!==void 0&&(r.push([l,5,c,p]),m.delete(c),m.size===0&&o.delete(l))}})):((0,g.observe)(e,(0,g.onAdd)(n,s),l=>{r.push([l,2,c])}),(0,g.observe)(e,(0,g.onRemove)(n,s),l=>{r.push([l,3,c])}))}),()=>{y=0;for(let s=0;s<r.length;s++){let[c,l,m,p,b]=r[s];u.setUint32(y,c),y+=4,u.setUint8(y,l),y+=1,(l===2||l===3||l===4||l===5)&&(u.setUint8(y,m),y+=1,(l===4||l===5)&&(u.setUint32(y,p),y+=4,l===4&&b&&(y=Be(b,c,u,y))))}return r.length=0,a.slice(0,y)}},be=(e,n,t,i={})=>{let a=i.idMap||new Map;return(u,y)=>{let r=y||a,o=new DataView(u),s=0;for(;s<u.byteLength;){let c=o.getUint32(s);s+=4;let l=o.getUint8(s);s+=1;let m=-1,p=-1;(l===2||l===3||l===4||l===5)&&(m=o.getUint8(s),s+=1,(l===4||l===5)&&(p=o.getUint32(s),s+=4));let b=t[m],f=r.get(c);if(l===0)f===void 0?(f=(0,g.addEntity)(e),r.set(c,f),(0,g.addComponent)(e,f,n)):console.warn(`Attempted to deserialize addEntity with ID ${c}, but it has already been deserialzied and exists in the mapping.`);else if(f!==void 0&&(0,g.entityExists)(e,f)){if(l===1)(0,g.removeEntity)(e,f),r.delete(c);else if(l===2)(0,g.addComponent)(e,f,b);else if(l===3)(0,g.removeComponent)(e,f,b);else if(l===4){let S=r.get(p);if(S!==void 0){let U=b(S);(0,g.addComponent)(e,f,U),s=je(U,f,o,s,r)}}else if(l===5){let S=r.get(p);S!==void 0&&(0,g.removeComponent)(e,f,b(S))}}}return r}};
//# sourceMappingURL=index.min.cjs.map
